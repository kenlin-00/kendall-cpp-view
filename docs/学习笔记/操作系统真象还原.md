
- [第8章](#第8章)
  - [实现 assert 断言](#实现-assert-断言)
  - [实现字符串操作函数](#实现字符串操作函数)

-----

## 第8章

### 实现 assert 断言

`intr_get_status` 获取中断状态，利用宏 GET_EFLAGS 来获取 eflags 寄存器的值并保存到变量 eflags 中，接下来再利用 EFLAGS_IF 与变量 eflags 禁止**位与运算**，判断其是否为 1。

`intr_enable` 是开中断，首先需要先调用 `intr_get_statue` 函数获取当前中断的状态，如果已经开中断状态，就直接返回，如果是关中断状态，就执行内联汇编 `asm volatile("sti")`，通过 sti 指令打开终端。最后返回操作前中断的状态 `old_status`，每个分支中添加 return 语句可以减少 jmp 语句，是的程序运行效率更高，但是程序也因此而变大，空间换时间。

> 开中断的原理就是**执行 sti 指令将 eflags 中的 IF 位 置为 1**


`intr_disable` 是**关中断**，其原理就是**执行 cli 指令将 eflags 的 IF 位置为 0**，当然也需要先调用 intr_get_status 获取当前的中断状态，如果已经是关中断状态，就直接返回 `INTR_OFF`，否则就通过内联汇编 `asm volatile("cli" : : : "memory");` 将中断打开，然后返回旧中断的状态。

`intr_set_status` 是设置中断状态，内部也是通过调用 `intr_disable` 和 `intr_enable` 实现的。


### 实现字符串操作函数

- memset 函数用于内存区域的数据初始化，原理是逐个字节地把 value 写入其实内存地址为 dst 的 size 个空间中。可以用于内存分配时对数据清 0。
- memcpy 函数用于内存数据拷贝，原理是将 src_ 起始的 size 个字节复制到 dst_，逐字节拷贝
- memcmp 函数用于一段内存数据比较，分别以两个地址 a_ 和 b_ 为起始，如果在 size 个字节内，a_ 中的某个内存字节的数值大于 b_ 中同一相对位置的内存数值，就返回 1，如果两个地址中同一位置的所有值都相等，就返回 0，否则返回 -1。

- strcpy 把其实地址 src_ 的字符串赋值到地址 dst_，这么 memcpy 类似，但是，strcpy 以 src_ 的字符 ’0‘ 作为终止条件，memcpy 以拷贝的字节数 size  作为终止条件。
- strlen 用于返回字符串的长度，也就是字符数
- strcmp 用于比较其实地址为 a  和 b 的两个字符串是否相等，a > b 返回 1，a = b 返回 0，a < b 返回 -1。
- strchr 返回字符 ch 在字符串 str 中的下标。

- strrchr 函数返回的是从后往前查找字符串 str 中首次出现字符 ch 的地址
- strcat 函数的功能是字符串拼接
- strchrs 用于返回字符 ch 在字符串 str 中出现的次数